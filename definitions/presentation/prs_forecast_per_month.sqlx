config {
    type: "view",
    schema: "c_forecast_dev",
    name: "int_forecast_per_month",
    tags: ['Sweden', 'Norway']
}

SELECT
  DATE_TRUNC(date, MONTH) AS date
  , EXTRACT(YEAR FROM date) AS year
  , EXTRACT(MONTH FROM date) AS month
  , CONCAT(EXTRACT(YEAR FROM date), ".", EXTRACT(MONTH FROM date)) AS year_month
  , name
  , employee_id
  , location
  , specialty
  , seniority
  , ROUND(SUM(public_holiday_hours), 1) AS public_holiday_hours
  ,ROUND(SUM(timeoff_hours), 1) AS timeoff_hours
  ,ROUND(SUM(client_hours), 1) AS client_hours
  ,ROUND(SUM(internal_hours), 1) AS internal_hours
  ,ROUND(SUM(other_hours), 1) AS other_hours
  ,ROUND(SUM(available_hours), 1) AS available_hours
  ,ROUND(SUM(capacity_hours), 1) AS capacity_hours

FROM
  ${ref("int_forecast_per_day")}


WHERE TRUE
  /* Logic to handle that the Forecast API only supports 180 day intervalls â€“ this will get the whole full month before 180 days from now. */
  AND (date BETWEEN DATE_TRUNC(CURRENT_DATE(), MONTH) AND DATE_ADD(LAST_DAY(DATE_ADD(CURRENT_DATE(), INTERVAL 180 DAY), MONTH), INTERVAL -1 MONTH))

GROUP BY
  date
  , year
  , month
  , year_month
  , name
  , employee_id
  , location
  , specialty
  , seniority


